<!-- ============================================================================ -->
<!-- user/my-flights.html - User Dashboard (My Bookings) -->
<!-- ============================================================================ -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('My Flights - SkyReserve')}"></head>
<body>

<nav th:replace="~{fragments/layout :: navbar}"></nav>

<main class="container mt-4">
    <h2 class="mb-4">
        <i class="bi bi-ticket-perforated"></i> My Flights
    </h2>

    <!-- Filter Tabs -->
    <ul class="nav nav-tabs mb-4" id="statusTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#all" type="button">
                All Bookings
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#confirmed" type="button">
                <i class="bi bi-check-circle text-success"></i> Confirmed
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#pending" type="button">
                <i class="bi bi-clock text-warning"></i> Pending
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#cancelled" type="button">
                <i class="bi bi-x-circle text-danger"></i> Cancelled
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="bookingsContent">
        <!-- All Bookings -->
        <div class="tab-pane fade show active" id="all" role="tabpanel">
            <div th:if="${#lists.isEmpty(bookings)}" class="text-center py-5">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <h4 class="mt-3 text-muted">No bookings yet</h4>
                <a href="/flights/search" class="btn btn-primary mt-3">
                    <i class="bi bi-search"></i> Search Flights
                </a>
            </div>

            <div th:each="booking : ${bookings}">
                <div th:replace="~{fragments/layout :: booking-card(${booking})}"></div>
            </div>
        </div>

        <!-- Confirmed -->
        <div class="tab-pane fade" id="confirmed" role="tabpanel">
            <div th:each="booking : ${bookings}" 
                 th:if="${booking.status.toString() == 'CONFIRMED'}">
                <div th:replace="~{fragments/layout :: booking-card(${booking})}"></div>
            </div>
        </div>

        <!-- Pending -->
        <div class="tab-pane fade" id="pending" role="tabpanel">
            <div th:each="booking : ${bookings}" 
                 th:if="${booking.status.toString() == 'PENDING'}">
                <div th:replace="~{fragments/layout :: booking-card(${booking})}"></div>
            </div>
        </div>

        <!-- Cancelled -->
        <div class="tab-pane fade" id="cancelled" role="tabpanel">
            <div th:each="booking : ${bookings}" 
                 th:if="${booking.status.toString() == 'CANCELLED'}">
                <div th:replace="~{fragments/layout :: booking-card(${booking})}"></div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/layout :: footer}"></footer>
<div th:replace="~{fragments/layout :: scripts}"></div>

<script>
    async function cancelBooking(bookingId) {
        if (!confirm('Are you sure you want to cancel this booking?')) {
            return;
        }

        try {
            const response = await fetch(`/api/bookings/${bookingId}/cancel`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            const result = await response.json();

            if (result.success) {
                alert('Booking cancelled successfully!');
                location.reload();
            } else {
                alert('Failed to cancel booking: ' + result.message);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        }
    }
</script>

</body>
</html>

